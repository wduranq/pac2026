<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plan Acad√©mico 2026 - EJE</title>
    <style>
        :root { 
            --eje-red: #b30000;      
            --warm-grey: #4a4a4a;    
            --bg-light: #f4f6f7;
            --white: #ffffff;
            --text-muted: #616161;
        }
        
        body { font-family: 'Segoe UI', Tahoma, Geneva, sans-serif; margin: 0; display: flex; background: var(--bg-light); color: #333; }
        
        /* Sidebar */
        nav { width: 310px; background: var(--warm-grey); color: white; height: 100vh; position: fixed; overflow-y: auto; z-index: 1000; border-right: 5px solid var(--eje-red); }
        .nav-header { padding: 30px 20px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.1); }
        nav ul { list-style: none; padding: 0; margin: 0; }
        nav ul li a { display: block; padding: 16px 25px; color: #f0f0f0; text-decoration: none; font-size: 0.8rem; border-bottom: 1px solid rgba(255,255,255,0.05); cursor: pointer; transition: 0.2s; }
        nav ul li a:hover, nav ul li a.active { background: var(--eje-red); color: white; font-weight: bold; }

        /* Main Content */
        main { margin-left: 310px; padding: 40px; width: 100%; box-sizing: border-box; }
        .header-main { margin-bottom: 40px; border-left: 10px solid var(--eje-red); padding-left: 20px; }
        .header-main h1 { margin: 0; color: var(--warm-grey); font-size: 2rem; text-transform: uppercase; }
        
		/* Toolbar corregida para Celulares */
        .toolbar { 
            display: flex; 
            gap: 15px; 
            margin-bottom: 35px; 
            align-items: center; 
            flex-wrap: wrap; /* Esto permite que los elementos bajen si no caben */
        }

        .view-toggle { 
            display: flex; 
            background: #e0e0e0; 
            border-radius: 8px; 
            padding: 4px;
            flex-shrink: 0;
        }

        .search-input { 
            flex: 1; 
            min-width: 200px; /* Evita que el buscador se haga min√∫sculo */
            padding: 12px 20px; 
            border-radius: 25px; 
            border: 2px solid #ddd; 
            outline: none; 
        }

        .download-pdf { 
            background: var(--eje-red); 
            color: white; 
            text-decoration: none; 
            padding: 12px 20px; 
            border-radius: 5px; 
            font-weight: bold; 
            font-size: 0.85rem;
            text-align: center;
            white-space: nowrap;
        }

        /* Ajustes para Celular (Media Query) */
        @media (max-width: 900px) { 
            nav { 
                width: 100%; 
                height: auto; 
                position: relative; 
                border-right: none;
                border-bottom: 5px solid var(--eje-red);
            } 
            main { 
                margin-left: 0; 
                padding: 20px; 
            } 
            body { 
                flex-direction: column; 
            }
            .toolbar {
                flex-direction: column; /* Apila todo en vertical en pantallas peque√±as */
                align-items: stretch;
            }
            .search-input {
                width: 100%;
                box-sizing: border-box;
            }
            .view-toggle {
                justify-content: center;
            }
            .grid {
                grid-template-columns: 1fr; /* Una sola columna de tarjetas en celular */
            }
            .modal-box {
                width: 95%;
                padding: 20px;
                border-left: 8px solid var(--eje-red);
            }
            .modal-grid {
                grid-template-columns: 1fr; /* La info del modal tambi√©n se apila */
            }
        }
        
        .view-toggle { display: flex; background: #e0e0e0; border-radius: 8px; padding: 4px; }
        .toggle-btn { padding: 8px 18px; border: none; cursor: pointer; border-radius: 6px; font-weight: bold; color: #666; background: transparent; }
        .toggle-btn.active { background: var(--white); color: var(--eje-red); box-shadow: 0 2px 4px rgba(0,0,0,0.1); }

        /* Grid Cards */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 25px; }
        .card { background: var(--white); padding: 25px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); cursor: pointer; border-top: 5px solid var(--warm-grey); transition: 0.3s; }
        .card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .card-label { font-size: 0.7rem; color: var(--eje-red); font-weight: bold; text-transform: uppercase; margin-bottom: 8px; display: block; }
        .card h3 { font-size: 1rem; margin: 0 0 15px 0; color: var(--warm-grey); height: 2.8em; overflow: hidden; }
        .card-meta { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.8rem; color: var(--text-muted); border-top: 1px solid #eee; padding-top: 12px; }

        /* Timeline View */
        .timeline { display: none; }
        .month-block { position: relative; padding-left: 120px; margin-bottom: 40px; border-left: 2px solid #ddd; margin-left: 20px; }
        .month-name { position: absolute; left: -30px; top: 0; background: var(--warm-grey); color: white; padding: 5px 15px; border-radius: 20px; font-size: 0.75rem; font-weight: bold; text-transform: uppercase; }
        .tl-card { background: white; margin-bottom: 10px; padding: 15px; border-radius: 4px; border-left: 5px solid var(--warm-grey); cursor: pointer; }

        /* Modal */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; align-items: center; justify-content: center; }
        .modal-box { background: white; width: 90%; max-width: 850px; padding: 40px; position: relative; border-left: 15px solid var(--eje-red); max-height: 90vh; overflow-y: auto; }
        .close-btn { position: absolute; top: 20px; right: 25px; font-size: 2.5rem; cursor: pointer; color: #999; }
        
        .info-extra-box { background: #f9f9f9; padding: 20px; border: 1px solid #eee; margin-top: 20px; }
        .info-extra-box b { display: block; color: var(--eje-red); font-size: 0.75rem; text-transform: uppercase; margin-bottom: 8px; }
        
        .modal-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-top: 25px; }
        .modal-item b { display: block; color: var(--eje-red); font-size: 0.72rem; text-transform: uppercase; margin-bottom: 4px; letter-spacing: 0.5px; }
        .modal-item div { font-size: 0.95rem; color: #333; line-height: 1.4; }

        @media (max-width: 900px) { nav { width: 100%; height: auto; position: relative; } main { margin-left: 0; } body { flex-direction: column; } }
    
	/* Estilos de etiquetas autom√°ticas */
.badge-auto {
    padding: 2px 8px;
    border-radius: 4px;
    color: white;
    font-size: 0.65rem;
    font-weight: bold;
    display: inline-block;
    margin-bottom: 5px;
}

/* Colores por tipo */
.bg-conferencia { background-color: #d35400; } /* Naranja: Cortos */
.bg-curso { background-color: #1a5276; }       /* Azul: Largos */
.bg-induccion { background-color: #27ae60; }   /* Verde: Autoformativos */
	
/* Ajuste de tarjetas con borde lateral din√°mico */
.card { 
    position: relative; /* Para posicionar el indicador */
    background: var(--white); 
    padding: 20px 25px 25px 35px; /* M√°s espacio a la izquierda para el borde */
    border-radius: 8px; 
    box-shadow: 0 4px 6px rgba(0,0,0,0.05); 
    cursor: pointer; 
    border-top: none; /* Quitamos el borde gris de arriba */
    border-left: 6px solid #ccc; /* Borde lateral por defecto */
    transition: 0.3s; 
}

/* Colores de los bordes laterales */
.border-conferencia { border-left-color: #d35400 !important; } /* Naranja */
.border-curso { border-left-color: #1a5276 !important; }       /* Azul */
.border-induccion { border-left-color: #27ae60 !important; }   /* Verde */

/* Estilo para el texto peque√±o del tipo de curso */
.tipo-mini {
    position: absolute;
    top: 10px;
    right: 15px;
    font-size: 0.6rem;
    font-weight: bold;
    color: #999;
    text-transform: uppercase;
}

.card-label { 
    font-size: 0.7rem; 
    color: var(--eje-red); 
    font-weight: bold; 
    text-transform: uppercase; 
    margin-bottom: 5px; 
    display: block; 
}

.social-box {
    margin-top: 15px;
    background: #f8f9fa;
    border-top: 1px solid #eee;
    padding: 10px;
    border-radius: 0 0 8px 8px;
}
.comentarios-view {
    max-height: 80px;
    overflow-y: auto;
    font-size: 0.8em;
    margin-bottom: 8px;
}
.comentario-form {
    display: flex;
    gap: 5px;
}
.comentario-form input {
    flex: 1;
    font-size: 0.8em;
    padding: 4px;
    border: 1px solid #ddd;
    border-radius: 4px;
}
.comentario-form button {
    background: #004a87;
    color: white;
    border: none;
    border-radius: 4px;
    padding: 0 8px;
    cursor: pointer;
}
	
/* Clase para ocultar */
.hidden {
    display: none !important;
}

.btn-toggle-social {
    cursor: pointer;
    color: #004a87;
    font-size: 0.85em;
    font-weight: bold;
    margin-top: 10px;
    padding: 5px;
    display: inline-block;
}

.btn-toggle-social:hover {
    background-color: #f0f0f0;
    border-radius: 4px;
}

.social-box {
    margin-top: 10px;
    background: #f8f9fa;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #eee;
}

.comentarios-view {
    max-height: 100px; /* Para que no crezca demasiado la tarjeta */
    overflow-y: auto;
    margin-top: 10px;
    border-top: 1px solid #ddd;
    padding-top: 5px;
}

.comentario-item {
    background: #ffffff;
    padding: 6px 10px;
    border-radius: 10px;
    margin-bottom: 6px;
    box-shadow: 0 1px 2px rgba(0,0,0,0.1);
    border-left: 3px solid #004a87; /* Una peque√±a l√≠nea del color institucional */
}

.comentario-item strong {
    color: #004a87;
    font-size: 0.9em;
}

.comentario-item span {
    font-size: 0.9em;
    color: #333;
}	
	
	</style>
</head>
<body>

<nav>
    <div class="nav-header">
        <h2 style="margin:0;">Escuela de Jueces del Estado</h2>
        <small>Formaci√≥n judicial de Excelencia para una Justicia de calidad</small>
    </div>
    <ul id="mainMenu">
        <li><a onclick="filter('all')" class="active">VISTA GENERAL</a></li>
        <li><a onclick="filter('CONSTITUCIONAL')">CONSTITUCIONAL</a></li>
        <li><a onclick="filter('PENAL')">PENAL</a></li>
        <li><a onclick="filter('CIVIL')">CIVIL</a></li>
        <li><a onclick="filter('FAMILIA')">FAMILIA</a></li>
		<li><a onclick="filter('NI√ëEZ Y ADOLESCENCIA')">NI√ëEZ Y ADOLESCENCIA</a></li>
        <li><a onclick="filter('LABORAL')">LABORAL</a></li>
		<li><a onclick="filter('COACTIVO FISCAL')">COACTIVO FISCAL</a></li>
        <li><a onclick="filter('AGROAMBIENTAL')">AGROAMBIENTAL</a></li>
        <li><a onclick="filter('APOYO JURISDICCIONAL')">APOYO JURISDICCIONAL</a></li>
    </ul>
</nav>

<main>
    <div class="header-main">
        <h1>Plan Anual de Capacitaci√≥n</h1>
        <h2 style="color: var(--eje-red); margin:0;">Gesti√≥n Acad√©mica 2026</h2>
    </div>

    <div class="toolbar">
        <div class="view-toggle">
            <button class="toggle-btn active" onclick="switchV('grid')">CURSOS</button>
            <button class="toggle-btn" onclick="switchV('timeline')">MESES</button>
        </div>
        <input type="text" id="search" class="search-input" placeholder="Buscar curso o tema..." onkeyup="runSearch()">
		<div id="user-status" style="text-align: right; padding: 10px; font-size: 14px;">
		</div>
        <a href="#" class="download-pdf">üìÑ DESCARGAR PLAN PDF</a>
    </div>

    <div id="grid-container" class="grid"></div>
    <div id="timeline-container" class="timeline"></div>
</main>

<div id="modal" class="modal">
    <div class="modal-box">
        <span class="close-btn" onclick="closeM()">&times;</span>
        <h2 id="mTitle" style="margin-top:0; color:var(--warm-grey); padding-right: 40px;"></h2>
        
        <div id="mContent" class="modal-grid"></div>

        <div id="modal-actions" style="margin-top: 25px; display: flex; gap: 10px;">
            <button id="btnProp" class="toggle-btn" style="background: #eee; border: 1px solid #ccc;" onclick="toggleBox('boxProp')">Ver Prop√≥sito ‚Üì</button>
            <button id="btnTemas" class="toggle-btn" style="background: #eee; border: 1px solid #ccc;" onclick="toggleBox('boxTemas')">Ver Contenido Tem√°tico ‚Üì</button>
        </div>
        
        <div id="boxProp" class="info-extra-box" style="display: none;">
            <b>PROP√ìSITO</b>
            <div id="mProp"></div>
        </div>

        <div id="boxTemas" class="info-extra-box" style="display: none;">
            <b>CONTENIDO TEM√ÅTICO</b>
            <div id="mTemas"></div>
        </div>
    </div>
</div>

<script>







    const meses = ["Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Permanente"];

   
	
	function renderCards(items) {
    const container = document.getElementById('grid-container');
    container.innerHTML = "";
    
    items.forEach(c => {
        let tipoTexto = "CURSO";
        let claseBorde = "border-curso";
        const horas = parseInt(c.h.replace(/\D/g, "")) || 0;

        if (c.t.toLowerCase().includes("inducci√≥n") || c.f.toLowerCase().includes("permanente")) {
            tipoTexto = "AUTOFORMATIVO";
            claseBorde = "border-induccion";
        } else if (horas > 0 && horas <= 8) {
            tipoTexto = "CONFERENCIA / TALLER";
            claseBorde = "border-conferencia";
        }

        const div = document.createElement('div');
        div.className = `card ${claseBorde}`;
        div.onclick = () => openModal(c);

        div.innerHTML = `
            <span class="tipo-mini">${tipoTexto}</span>
            <span class="card-label">${c.m}</span>
            <h3>${c.t}</h3>
            <div class="card-meta">
                <div>üìÖ ${c.f}</div>
                <div>‚è≥ ${c.h}</div>
                <div>üìç ${c.mod}</div>
                <div>üíª ${c.p}</div>
            </div>

           	<div class="btn-toggle-social" id="btn-social-${c.id}" onclick="toggleSocial(event, '${c.id}')">
			üí¨ Comentarios
			</div>
            
            <div class="social-box hidden" id="social-${c.id}" onclick="event.stopPropagation()"> 
                <div class="comentario-form">
                    
					<input type="text" id="input-${c.id}" 
						placeholder="Clic aqu√≠ para comentar..." 
						onclick="if(!usuarioLogueado) iniciarSesionGoogle()"
						onkeypress="if(event.key==='Enter') publicarComentario('${c.id}')">
                    
					<button onclick="publicarComentario('${c.id}')">‚û§</button>
                </div>
                
                <div class="comentarios-view" id="lista-${c.id}">
                    <small style="color: #ccc;">Cargando comentarios...</small>
                </div>
            </div>
        `;
        
        container.appendChild(div);

        if(c.id) {
            cargarComentarios(c.id);
        }
    });
}
	
	
	function renderTimeline(items) {
    const container = document.getElementById('timeline-container');
    container.innerHTML = "";
    meses.forEach(mes => {
        const filtered = items.filter(c => c.mes === mes);
        if(filtered.length > 0) {
            const block = document.createElement('div');
            block.className = 'month-block';
            block.innerHTML = `<span class="month-name">${mes}</span>`;
            
            filtered.forEach(c => {
                const horas = parseInt(c.h.replace(/\D/g, "")) || 0;
                let claseBorde = (horas > 0 && horas <= 8) ? "border-conferencia" : "border-curso";
                if(c.f.toLowerCase().includes("permanente")) claseBorde = "border-induccion";

                const tlCard = document.createElement('div');
                tlCard.className = `tl-card ${claseBorde}`; // Mismo borde que en las cards
                tlCard.onclick = () => openModal(c);
                tlCard.innerHTML = `<b>${c.m}:</b> ${c.t} <br> <small>‚è≥ ${c.h}</small>`;
                block.appendChild(tlCard);
            });
            container.appendChild(block);
        }
    });
}

    function openModal(c) {
        document.getElementById('mTitle').innerText = c.t;
        
        // Prop√≥sito y Temas (solo si existen)
        const boxProp = document.getElementById('boxProp');
        if(c.prop && c.prop.trim() !== "") {
            boxProp.style.display = "block";
            document.getElementById('mProp').innerText = c.prop;
        } else { boxProp.style.display = "none"; }

        const boxTemas = document.getElementById('boxTemas');
        if(c.temas && c.temas.trim() !== "") {
            boxTemas.style.display = "block";
            document.getElementById('mTemas').innerHTML = c.temas;
        } else { boxTemas.style.display = "none"; }

        // Mapeo de campos requeridos (con los nuevos campos a√±adidos)
        const fields = [
            { label: "TIPO DE ACCI√ìN DE CAPACITACI√ìN", value: c.tipo },
            { label: "MODALIDAD", value: c.mod },
            { label: "FECHA", value: c.f },
            { label: "CARGA HORARIA", value: c.h },
            { label: "DIRIGIDO A", value: c.d },
            { label: "PLATAFORMAS VIRTUALES", value: c.p },
            { label: "CARACTER DEL CURSO", value: c.caracter },
            { label: "CARACTER DE LA ACCI√ìN DE CAPACITACI√ìN", value: c.caracterAccion },
            { label: "SISTEMA DE EVALUACI√ìN", value: c.sistemaEval }
        ];

        let contentHtml = "";
        fields.forEach(f => {
            // Solo a√±adir el HTML si el valor existe y no es solo espacio
            if(f.value && f.value.toString().trim() !== "") {
                contentHtml += `<div class="modal-item"><b>${f.label}</b><div>${f.value}</div></div>`;
            }
        });

        document.getElementById('mContent').innerHTML = contentHtml;
        document.getElementById('modal').style.display = "flex";
    }

    function switchV(v) {
        document.querySelectorAll('.toggle-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        document.getElementById('grid-container').style.display = v === 'grid' ? 'grid' : 'none';
        document.getElementById('timeline-container').style.display = v === 'timeline' ? 'block' : 'none';
    }

    function filter(m) {
        document.querySelectorAll('nav a').forEach(a => a.classList.remove('active'));
        if(event && event.target.tagName === 'A') event.target.classList.add('active');
        const filtered = m === 'all' ? data : data.filter(c => c.m.includes(m));
        renderCards(filtered);
        renderTimeline(filtered);
    }

    function runSearch() {
        const q = document.getElementById('search').value.toLowerCase();
        const filtered = data.filter(c => Object.values(c).join(' ').toLowerCase().includes(q));
        renderCards(filtered);
        renderTimeline(filtered);
    }

    function closeM() { document.getElementById('modal').style.display = "none"; }
    
   // renderCards(data);
   // renderTimeline(data);
</script>

<script>
    // --- NUEVA FUNCI√ìN PARA ABRIR EL MODAL ---
    function openModal(c) {
        document.getElementById('mTitle').innerText = c.t;
        
        // Limpiamos y ocultamos las cajas extras siempre al abrir
        document.getElementById('boxProp').style.display = "none";
        document.getElementById('boxTemas').style.display = "none";

        // L√≥gica para el bot√≥n de Prop√≥sito
        const btnProp = document.getElementById('btnProp');
        if(c.prop && c.prop.trim() !== "") {
            btnProp.style.display = "inline-block";
            document.getElementById('mProp').innerText = c.prop;
        } else { btnProp.style.display = "none"; }

        // L√≥gica para el bot√≥n de Temas
        const btnTemas = document.getElementById('btnTemas');
        if(c.temas && c.temas.trim() !== "") {
            btnTemas.style.display = "inline-block";
            document.getElementById('mTemas').innerHTML = c.temas;
        } else { btnTemas.style.display = "none"; }

        // Mapeo de campos t√©cnicos (Los que se ven primero)
        const fields = [
            { label: "TIPO DE ACCI√ìN DE CAPACITACI√ìN", value: c.tipo },
            { label: "MODALIDAD", value: c.mod },
            { label: "FECHA", value: c.f },
            { label: "CARGA HORARIA", value: c.h },
            { label: "DIRIGIDO A", value: c.d },
            { label: "PLATAFORMAS VIRTUALES", value: c.p },
            { label: "CAR√ÅCTER DEL CURSO", value: c.caracter },
            { label: "CAR√ÅCTER DE LA ACCI√ìN DE CAPACITACI√ìN", value: c.caracterAccion },
            { label: "SISTEMA DE EVALUACI√ìN", value: c.sistemaEval }
        ];

        let contentHtml = "";
        fields.forEach(f => {
            if(f.value && f.value.toString().trim() !== "") {
                contentHtml += `<div class="modal-item"><b>${f.label}</b><div>${f.value}</div></div>`;
            }
        });

        document.getElementById('mContent').innerHTML = contentHtml;
        document.getElementById('modal').style.display = "flex";
    }

    // --- FUNCI√ìN PARA MOSTRAR/OCULTAR LAS CAJAS ---
    function toggleBox(id) {
        const box = document.getElementById(id);
        if (box.style.display === "none") {
            box.style.display = "block";
            event.target.innerText = event.target.innerText.replace("Ver", "Ocultar").replace("‚Üì", "‚Üë");
            event.target.style.background = "var(--eje-red)";
            event.target.style.color = "white";
        } else {
            box.style.display = "none";
            event.target.innerText = event.target.innerText.replace("Ocultar", "Ver").replace("‚Üë", "‚Üì");
            event.target.style.background = "#eee";
            event.target.style.color = "#666";
        }
    }
</script>

<script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>

<script> 
  // Tu configuraci√≥n de Firebase
 const firebaseConfig = {
    apiKey: "AIzaSyDvLInjNG-aTtcy9Aah9YYD38HOPpyugPc",
    authDomain: "cursos-login-41bf9.firebaseapp.com",
    databaseURL: "https://cursos-login-41bf9-default-rtdb.firebaseio.com",
    projectId: "cursos-login-41bf9",
    storageBucket: "cursos-login-41bf9.firebasestorage.app",
    messagingSenderId: "919456691740",
    appId: "1:919456691740:web:b941767f9057ebac03d1d9"
  };

  // Inicializamos Firebase
	firebase.initializeApp(firebaseConfig);
	const db = firebase.database();
  
	const auth = firebase.auth();
	const provider = new firebase.auth.GoogleAuthProvider();

	let usuarioLogueado = null;
	// Escuchamos si el usuario ya est√° logueado (para no pedirle login cada vez)
	auth.onAuthStateChanged(user => {
    const statusDiv = document.getElementById('user-status');
    usuarioLogueado = user;
    
    if (user) {
        statusDiv.innerHTML = `
            <span>Conectado como <b>${user.displayName}</b></span> 
            <button onclick="auth.signOut()" style="background:none; border:none; color:red; cursor:pointer; text-decoration:underline; margin-left:10px;">Salir</button>
        `;
        document.querySelectorAll('.comentario-form input').forEach(i => i.placeholder = "Escribe un comentario...");
    } else {
        statusDiv.innerHTML = `<small style="color:gray;">No has iniciado sesi√≥n</small>`;
        document.querySelectorAll('.comentario-form input').forEach(i => i.placeholder = "Inicia sesi√≥n para comentar...");
    }
});

	// Funci√≥n para invocar el login de Google
	async function iniciarSesionGoogle() {
    try {
        const result = await auth.signInWithPopup(provider);
        usuarioLogueado = result.user;
        console.log("Sesi√≥n iniciada:", usuarioLogueado.displayName);
        return result.user;
    } catch (error) {
        // Si el usuario simplemente cerr√≥ la ventana, no mostramos error
        if (error.code === 'auth/popup-closed-by-user') {
            console.log("El usuario cerr√≥ la ventana de login sin autenticarse.");
        } else {
            // Solo mostrar otros errores t√©cnicos en la consola para no molestar al usuario
            console.error("Error de Firebase:", error.code, error.message);
        }
        return null; 
    }
}

 

////
  // --- NUEVA L√ìGICA PARA CARGAR CURSOS DESDE FIREBASE ---
  let data = []; // Variable global donde guardaremos los cursos que vienen de la nube

  // Esta funci√≥n descarga los cursos una sola vez y renderiza la p√°gina
  function descargarCursos() {
    const cursosRef = db.ref('cursos');
    cursosRef.on('value', (snapshot) => {
        const rawData = snapshot.val();
        if (rawData) {
            // Convertimos el objeto de Firebase en un Array para que tus funciones filter y search funcionen
            data = Object.values(rawData); 
            
            // Llamamos a tus funciones originales para pintar la pantalla
            renderCards(data);
            renderTimeline(data);
        } else {
            document.getElementById('grid-container').innerHTML = "No se encontraron cursos.";
        }
    });
  }

  // Llamamos a la descarga al iniciar
  descargarCursos();
  

  // FUNCI√ìN PARA PUBLICAR UN COMENTARIO
  // Modificamos la funci√≥n de publicar para que sea inteligente
	async function publicarComentario(cursoId) {
    const input = document.getElementById(`input-${cursoId}`);
    const texto = input.value;

    if (texto.trim() === "") return;

    if (!usuarioLogueado) {
        const user = await iniciarSesionGoogle();
        // Si el usuario cancel√≥ el login (user es null), salimos de la funci√≥n sin error
        if (!user) return; 
        
        ejecutarEnvio(cursoId, texto, user);
    } else {
        ejecutarEnvio(cursoId, texto, usuarioLogueado);
    }

    input.value = ""; 
}
	
	function ejecutarEnvio(cursoId, mensaje, user) {
    db.ref('comentarios/' + cursoId).push({
        usuario: user.displayName,
        foto: user.photoURL,
        mensaje: mensaje,
        fecha: new Date().toLocaleString()
    });
	}

  // FUNCI√ìN PARA CARGAR COMENTARIOS AUTOM√ÅTICAMENTE
  function cargarComentarios(cursoId) {
    const contenedor = document.getElementById(`lista-${cursoId}`);
    const boton = document.getElementById(`btn-social-${cursoId}`);
    
    db.ref('comentarios/' + cursoId).on('value', (snapshot) => {
        const datos = snapshot.val();
        contenedor.innerHTML = ""; 

        if (datos) {
            const listaMensajes = Object.values(datos);
            const cantidad = listaMensajes.length;

            // ACTUALIZA EL BOT√ìN CON EL N√öMERO
            boton.innerHTML = `üí¨ ${cantidad} ${cantidad === 1 ? 'Comentario' : 'Comentarios'}`;

            // Busca el bucle donde recorres los comentarios y usa este HTML:
				listaMensajes.forEach(c => {
					contenedor.innerHTML += `
						<div class="comentario-item" style="display:flex; gap:10px; margin-bottom:10px; align-items:flex-start;">
							<img src="${c.foto}" style="width:28px; height:28px; border-radius:50%; border:1px solid #ddd;">
							<div style="background:#f0f2f5; padding:8px 12px; border-radius:15px; flex:1;">
								<strong style="font-size:0.85em; color:#004a87; display:block;">${c.usuario}</strong>
								<span style="font-size:0.9em; color:#333;">${c.mensaje}</span>
								<small style="display:block; color:#999; font-size:9px; margin-top:4px;">${c.fecha}</small>
							</div>
						</div>
					`;
				});
			
			
        } else {
            // TEXTO CUANDO NO HAY NADA
            boton.innerHTML = `üí¨ Sin comentarios`;
            contenedor.innerHTML = "<p style='color:#ccc; font-size:11px;'>S√© el primero en comentar...</p>";
        }
    });
}
  
  function toggleSocial(event, id) {
    event.stopPropagation(); // Importante para no abrir el modal
    const box = document.getElementById(`social-${id}`);
    box.classList.toggle('hidden');
}

  
</script>


</body>
</html>
